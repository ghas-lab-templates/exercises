# Module 4 - Autofix 

---

In the following labs, you will be remediating an existing SQL Injection vulnerability in `main.go` on line 309. There are two tasks to remediate this vulnerability:

1. sanitize input in the javascript (Lab 1)
2. fix the SQL prepare statement in the go code (Lab 2)

## Lab 1 - Autofix on PR 

#### Objective

Input sanitization is a fundamental security practice to prevent SQL injection attacks. Let's add a sanitize method in the javascript to help in mitigating against injection attack vectors.

You can solve this exercise using either the codespaces or the UI. Codespaces is preferable as this is what a developer would use under normal circumstances. However, if codespaces is not loading for you please use the UI. 

#### Steps

1. Create a branch called `sql-injection-fix` and push it to the remote repo.

    <details>
      <summary> Hint </summary>
      Run the command:
        
      ```
        $ git checkout -b sql-injection-fix
        $ git push -u origin sql-injection-fix
      ```
     </details>

    <details>
      <summary> Animated Guide </summary>  
        
      ![create-branch](/images/create-branch.gif)
  
    </details>
     

2. Add the following sanitization function on **line 233** of `frontend/components/Gallery.vue`

    ```js
    function sanitizeInput(input) {
        if (input == null) {
            return "";
        }
        //escape all occurances of apostrophe
        input = input.replace("'", "''");
    
        return input;
    }
    ```

3. Call the sanization function from the Update function by placing the following call on **line 347** of `/frontend/components/Gallery.vue`

    ```js
        artItem.description = sanitizeInput(artItem.description)
        artItem.title = sanitizeInput(artItem.title)
    ```

4. Commit and push the code

    <details>
       <summary> Animated Guide  </summary>  
        
       ![sanitization](/images/sanitise-method.gif)
       
    </details>

5. Raise a pull request to the `main` branch. Wait for the scans to complete and you should see a CodeQL javascript alert in your pull request. Oh no! There is a vulnerability in our vulnerability! Lucky we have autofix. Review the fix generated by autofix and if satisfied with it accept it. 

## Lab 2 - Autofix on Open Alerts

#### Objective 
In this lab, we will address two CodeQL alerts related to SQL Injection vulnerabilities in our Go code.

#### Steps

1. Navigate to each SQL Injection alert and click  the `Generate Fix` button
2. Once the fix is generated, carefully review it to ensure accuracy. AI-generated suggestions can vary, so verifying each proposed solution is crucial 
3. Click the dropdown arrow on the green `Commit to new branch` button and select `Commit to branch`.
4. Choose the `sql-injection-fix` branch from the dropdown options, and select `Open a new pull request`. This will append your changes to the existing PR.

Proceed with these steps until both alerts are resolved.

<details>
   <summary> Animated Guide  </summary>  
    
   ![sanitization](/images/generate-fix.gif)
   
</details>
